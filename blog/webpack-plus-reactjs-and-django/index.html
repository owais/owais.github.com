




<!DOCTYPE html>
<html>
<head>
    <title>Using Webpack transparently with Django &#43; hot reloading React components as a bonus</title>

        <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="Learn how to use Django transparently with webpack. Keep your frontend build pipeline de-coupled from your Django project to get the best of both worlds.">
    <meta name="keywords" content="React,Django,Webpack,">
    <meta name="author" content="Owais Lone">

        
    <meta property="og:type" content="article" />
    <meta property="artitle:author" content="Owais Lone" />
    <meta property="article:published" content="2015-05-23 00:31:14 &#43;0800 &#43;0800" />
    <meta property="article:updated" content="2015-05-23 00:31:14 &#43;0800 &#43;0800" />
    <meta property="article:section" content="Web Development" />
    <meta property="article:tag" content="React,Django,Webpack,">
    
    <meta property="og:title" content="Using Webpack transparently with Django &#43; hot reloading React components as a bonus" />
    <meta property="og:description" content="Learn how to use Django transparently with webpack. Keep your frontend build pipeline de-coupled from your Django project to get the best of both worlds." />
    <meta property="og:locale" content="en_US" />
    <meta property="og:url" content="https://owais.lone.pw/blog/webpack-plus-reactjs-and-django/" />
    <meta property="og:site_name" content="Owais Lone" />
        <meta property="og:image" content="https://owais.lone.pw/blog/webpack-plus-reactjs-and-django/header_hu449f6197ab277452710409733197284b_115242_800x200_fit_q75_box.jpg"/>

        <meta name="twitter:creator" content="@owaislone">
    <meta name="twitter:site" content="Owais Lone" />
    <meta name="twitter:title" content="Using Webpack transparently with Django &#43; hot reloading React components as a bonus" />
    <meta name="twitter:description" content="Learn how to use Django transparently with webpack. Keep your frontend build pipeline de-coupled from your Django project to get the best of both worlds." />
    
    
    <meta name="twitter:image" content="https://owais.lone.pw/blog/webpack-plus-reactjs-and-django/header_hu449f6197ab277452710409733197284b_115242_800x200_fit_q75_box.jpg" />
    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:label1" value="Reading Time" />
    <meta name="twitter:data1" value="10 minutes" />


    <base href="https://owais.lone.pw/" />

    <link href="" rel="alternate" type="application/rss+xml" title="Owais Lone" />
    <link rel="shortcut icon" href="/favicon.png">

    <link href="https://owais.lone.pw/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="https://owais.lone.pw/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://owais.lone.pw/css/style.css">

    <link href="http://gmpg.org/xfn/11" rel="profile">

    <meta name="generator" content="Hugo 0.97.3" />
</head>


<body>
<div id="container">
    <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            <a id="logo" class="logo-text" href="https://owais.lone.pw/">Owais Lone</a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="/blog/index.xml">RSS</a>
                
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>
</header>
    
      <img src="https://owais.lone.pw/blog/webpack-plus-reactjs-and-django/header_hu449f6197ab277452710409733197284b_115242_1280x400_fit_q75_box.jpg" class="article-banner"/>
    

    <section id="main" class="outer">
        <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">Using Webpack transparently with Django &#43; hot reloading React components as a bonus</h1>
        </header>
        
        <div class="article-meta">
            <a href="/blog/webpack-plus-reactjs-and-django/" class="article-date">
                <time datetime='2015-05-23T00:31:14.000&#43;08:00' itemprop="datePublished">2015-05-23</time>
            </a>
            
            
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            <p>If you don&rsquo;t already know <a href="http://webpack.github.io/docs/what-is-webpack.html">webpack</a>, you&rsquo;ve some <a href="https://egghead.io/lessons/javascript-intro-to-webpack" target="_blank">catching up to do</a>.</p>
<blockquote>
<p>Webpack is a module bundler that bundles javascript and other assets for the browser. It works really well for applications and javascript libraries and is very simple frontend build tool.</p>
<p>- Kent C. Dodds <small> -  <a href="https://egghead.io/lessons/javascript-intro-to-webpack">https://egghead.io/lessons/javascript-intro-to-webpack</a></small></p>
</blockquote>
<!-- more -->
<h2 id="objectives-and-reasoning">Objectives and reasoning</h2>
<p>We&rsquo;ll be setting up webpack and keeping it decoupled from django&rsquo;s staticfiles system. Read <a href="http://owais.lone.pw/blog/modern-frontends-with-django/" target="_blank">my earlier post</a> explaining why we&rsquo;ll be handling things this way and not integrating with staticfiles. We&rsquo;ll be using <a href="https://github.com/owais/webpack-bundle-tracker" target="_blank">webpack-bundle-tracker</a> to extract information from webpack and <a href="https://github.com/owais/django-webpack-loader/">django-webpack-loader</a> to use the extracted information for django integration.</p>
<h2 id="setting-up-webpack">Setting up webpack</h2>
<p>We&rsquo;ll use <a href="http://npmjs.com/">npm</a> to manage our frontend dependencies instead of managing them manually in one of the static files directories. You can also use <a href="http://bower.io/">bower</a> in addition to npm.</p>
<p>First let&rsquo;s setup npm in the root of your django project. This will generate a file called <code>package.json</code> in your project root. It serves 2 purposes. Imagine requirements.txt and setup.py merged into one. That is package.json for npm packages. If you use the <code>--save</code> or <code>--save-dev</code> flag when installing a package, it&rsquo;ll save the packages as dependencies in the package.json file. To reinstall the packages, all you need to is run <code>npm install</code>. Awesome, right? It gets better. The packages will be installed locally specific to your project under a directory called node_modules like virtualenv. To install a package globally, all you need to do is to use <code>-g</code> with npm install.</p>
<p>So, let&rsquo;s generate a package.json file in our project root using npm init</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm init
</span></span></code></pre></div><h3 id="npm-dependencies">Npm dependencies</h3>
<p>In addition to webpack, we&rsquo;ll at least need the webpack-bundle-tracker plugin to extract useful information from webpack and store it in as json in a file. This file will act as the link between webpack and django.</p>
<p>Since we&rsquo;ll be setting up webpack with an example reactjs app, we&rsquo;ll also need <a href="https://babeljs.io/" tatget="_blank">babel</a>. Babel is a great Javascript compiler that compiles ES6 into ES5 among other things. This lets use write next generation javascript today and still have run work in current browsers. Babel also supports react&rsquo;s JSX language so we don&rsquo;t need an additional compiler for that.</p>
<p>We&rsquo;ll also need babel-loader to integrate babel with webpack. Webpack supports pluggable libraries called loaders that add support for different types of files and languages. Loaders can also be chained. For example, you can make a less file go through a less loader to compile it to css and then pass the output  through a css loader. <a href="http://webpack.github.io/docs/using-loaders.html" target="_blank">More on loaders here</a>.</p>
<h3 id="save-vs-save-dev">save vs save-dev</h3>
<p><code>--save</code> saves the packages you install as dependencies of your package. The packages that must be installed in order to run your package. <code>--save-dev</code> saves the packages as build dependencies, the packages that must be installed to hack on your package. Since we are not going to be publishing a real npm package, either one works. I like to use &ndash;save-dev as I only need the packages to build my bundles. Whatever the bundle depends on is included in the bundle itself.</p>
<p>Let&rsquo;s install our first npm packages</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install --save-dev react webpack webpack-bundle-tracker babel babel-loader
</span></span></code></pre></div><h3 id="create-webpack-config">Create webpack config</h3>
<pre tabindex="0"><code>mkdir -p assets/js
touch webpack.config.js
touch assets/js/index.js
</code></pre><p>Let&rsquo;s create a simple webpack config to load <code>.jsx</code> files using babel and use the <code>webpack-bundle-tracker</code> plugin to extract information to <code>webpack-stats.json</code>. <a href="http://webpack.github.io/docs/configuration.html" target="_blank">More on webpack configuration here</a>.</p>
<p><code>webpack.config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;path&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">webpack</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">BundleTracker</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack-bundle-tracker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">__dirname</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">entry</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./assets/js/index&#39;</span>, <span style="color:#75715e">// entry point of our app. assets/js/index.js should require other js modules and dependencies it needs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">output</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;./assets/bundles/&#39;</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;[name]-[hash].js&#34;</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BundleTracker</span>({<span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./webpack-stats.json&#39;</span>}),
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">module</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">loaders</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      { <span style="color:#a6e22e">test</span><span style="color:#f92672">:</span> <span style="color:#e6db74">/\.jsx?$/</span>, <span style="color:#a6e22e">exclude</span><span style="color:#f92672">:</span> <span style="color:#e6db74">/node_modules/</span>, <span style="color:#a6e22e">loader</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;babel-loader&#39;</span>}, <span style="color:#75715e">// to transform JSX into JS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resolve</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">modulesDirectories</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;node_modules&#39;</span>, <span style="color:#e6db74">&#39;bower_components&#39;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">extensions</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;.js&#39;</span>, <span style="color:#e6db74">&#39;.jsx&#39;</span>]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>At this point, our directory structure will look something like this.</p>
<pre tabindex="0"><code>root/
├── manage.py
├── package.json
│── webpack.config.js
│── webpack-stats.json # generated by webpack
├── node_modules/ #contains our JS dependencies. This is like python&#39;s virtualenv directory
├── assets/ #added to STATICFILES_DIRS
│   └── js/ # contains out JS source code
│   └── bundles/ # generated by webpack
</code></pre><h3 id="compiling-our-first-bundle">Compiling our first bundle</h3>
<p>Binaries shipped with node packages are installed to <code>node_modules/.bin/</code> and it not added to <code>$PATH</code> automatically so we need to use full paths to the binaries. Installing binaries globablly like <code>npm install -g webpack</code> will add them to one of the binary location on in <code>$PATH</code>.</p>
<p>Let&rsquo;s go ahead and compile our first bundle</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node_modules/.bin/webpack --config webpack.config.js
</span></span></code></pre></div><p>This should create bundle at <code>assets/bundles/main-[hash].js</code>. This is good but we don&rsquo;t want to create bundles manually every time we make changes to our code.</p>
<h3 id="watch-mode">Watch mode</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node_modules/.bin/webpack --config webpack.config.js --watch
</span></span></code></pre></div><p>This will leave the compiler running and compile bundles automatically when you change any of your source files. You&rsquo;ll need to restart it if you make any changes to the webpack configuration though.</p>
<hr>
<h2 id="example-react-app">Example react app</h2>
<p><a href="#Django_integration">Skip this part</a> if you already have a react app running.</p>
<p>Let&rsquo;s write a simple &ldquo;hello, world&rdquo; react app and use webpack to compile it. We refer to <code>./assets/js/index</code> as the entry point of our app in <code>webpack.config.js</code> which will look for <code>index</code>, <code>index.js</code> or <code>index.jsx</code> because we&rsquo;ve added these three extensions to our webpack config under the key <code>resolve</code>.</p>
<p><code>assets/js/index.jsx</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">React</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;react&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">App</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./app&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">render</span>(<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">App</span><span style="color:#f92672">/&gt;</span>, document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;react-app&#39;</span>))
</span></span></code></pre></div><br>
`assets/js/app.jsx`
```javascript
var React = require('react')
<p>module.exports = React.createClass({
render: function(){
return <h1>Hello, world.</h1>
}
})</p>
<pre tabindex="0"><code>
If you left webpack running in watch mode, it should automatically pick up the changes and compile a new bundle.
&lt;br&gt;

&lt;hr&gt;
## Django integration

Now that we&#39;ve handed off the build process webpack, only thing we need on the django side is to know which bundle to include in our html pages. This is where `django-webpack-loader` comes in. It&#39;ll also raise exceptions when webpack fails to build a bundle and will show some useful information to help debug the problem. During development, webpack loader will also block requests while a new bundle is being generated so that only the latest bundles are loaded.

### Requirements
```bash
pip install django-webpack-loader
</code></pre><h3 id="configuration">Configuration</h3>
<h4 id="settingspy">settings.py</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BASE_DIR <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(__file__)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>STATICFILES_DIRS <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(BASE_DIR, <span style="color:#e6db74">&#39;assets&#39;</span>), <span style="color:#75715e"># We do this so that django&#39;s collectstatic copies or our bundles to the STATIC_ROOT or syncs them to whatever storage we use.</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WEBPACK_LOADER <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;DEFAULT&#39;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;BUNDLE_DIR_NAME&#39;</span>: <span style="color:#e6db74">&#39;bundles/&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;STATS_FILE&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(BASE_DIR, <span style="color:#e6db74">&#39;webpack-stats.json&#39;</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INSTALLED_APPS <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#39;webpack_loader&#39;</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="usage">Usage</h3>
<h4 id="in-templates">In templates</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>{% load render_bundle from webpack_loader %}
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Example&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;react-app&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    {% render_bundle &#39;main&#39; %}
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><code>render_bundle</code> will render the required <code>&lt;script&gt;</code> and <code>&lt;link&gt;</code> tags in the template.</p>
<p>Everything we need is in place now. Bundles will be automatically generated (provided you start webpack with &ndash;watch). Django will automatically pick up latest bundles from <code>assets/bundles</code> directory. During development, django will also block any requests while the bundles are being compiled. It&rsquo;ll also propagate errors generated by webpack to django.</p>
<p>Now that we&rsquo;ve webpack working with django, let&rsquo;s make things a little more fun by setting up hot reloading for our react components.</p>
<hr>
## Bonus: Live editing react components
Since we are using pure webpack without any abstraction, we are free to use it however we want without the need to integrate any special with django. Whenever something new comes up for webpack, we can immediately use it without worrying if staticfiles, pipeline or compressor will support it or not. Decoupling FTW!
<p>We&rsquo;ll use a library called <a href="http://gaearon.github.io/react-hot-loader/" target="_blank">react-hot-loader</a> by <a href="https://github.com/gaearon/react-hot-loader" target="_blank">Dan Abramov</a>. We&rsquo;ll also need <a href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a> to build and serve our bundles if we want to hot reload any modules.</p>
<h3 id="requirements">Requirements</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install --save-dev webpack-dev-server react-hot-loader
</span></span></code></pre></div><p>Let&rsquo;s modify <code>webpack.config.js</code> to use webpack-dev-server and react-hot-loader</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;path&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">webpack</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">BundleTracker</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack-bundle-tracker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">__dirname</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">entry</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;webpack-dev-server/client?http://localhost:3000&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;webpack/hot/only-dev-server&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;./assets/js/index&#39;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">output</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;./assets/bundles/&#39;</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;[name]-[hash].js&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">publicPath</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://localhost:3000/assets/bundles/&#39;</span>, <span style="color:#75715e">// Tell django to use this URL to load packages and not use STATIC_URL + bundle_name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">webpack</span>.<span style="color:#a6e22e">HotModuleReplacementPlugin</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">webpack</span>.<span style="color:#a6e22e">NoErrorsPlugin</span>(), <span style="color:#75715e">// don&#39;t reload if there is an error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BundleTracker</span>({<span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./webpack-stats.json&#39;</span>}),
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">module</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">loaders</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// we pass the output from babel loader to react-hot loader
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      { <span style="color:#a6e22e">test</span><span style="color:#f92672">:</span> <span style="color:#e6db74">/\.jsx?$/</span>, <span style="color:#a6e22e">exclude</span><span style="color:#f92672">:</span> <span style="color:#e6db74">/node_modules/</span>, <span style="color:#a6e22e">loaders</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;react-hot&#39;</span>, <span style="color:#e6db74">&#39;babel&#39;</span>], },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resolve</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">modulesDirectories</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;node_modules&#39;</span>, <span style="color:#e6db74">&#39;bower_components&#39;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">extensions</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;.js&#39;</span>, <span style="color:#e6db74">&#39;.jsx&#39;</span>]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Instead of running <code>webpack --watch</code>, we&rsquo;ll run webpack-dev-server to both compile and serve our bundles. The server will run on port 3000. <code>publicPath</code> in our webpack config refers to this server. Note that the server will by default keep the bundles in memory and not write to disk, so don&rsquo;t be surprised if you don&rsquo;t see anything new in <code>assets/bundles/</code>. Let&rsquo;s use webpack-dev-server&rsquo;s API to create a new instance of the server and pass webpack initialized without config file to it. We&rsquo;ll store this as <code>server.js</code> in our project root and use node run the server.</p>
<p><code>server.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">webpack</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">WebpackDevServer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack-dev-server&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;./webpack.config&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WebpackDevServer</span>(<span style="color:#a6e22e">webpack</span>(<span style="color:#a6e22e">config</span>), {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">publicPath</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">output</span>.<span style="color:#a6e22e">publicPath</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">hot</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">inline</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">historyApiFallback</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}).<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">3000</span>, <span style="color:#e6db74">&#39;0.0.0.0&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">result</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Listening at 0.0.0.0:3000&#39;</span>)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>Taken from <a href="https://github.com/gaearon/react-hot-boilerplate/">https://github.com/gaearon/react-hot-boilerplate/</a></p>
<p>Now instead of running webpack in watch mode, we run webpack-dev-server like this</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node server.js
</span></span></code></pre></div><p>Done! Any changes made to the react components will reflect in the browser. No reload needed. Magic! right?</p>
<p>If you are interested in hot reloading react components, you should read this <a href="https://medium.com/@dan_abramov/the-death-of-react-hot-loader-765fa791d7c4">https://medium.com/@dan_abramov/the-death-of-react-hot-loader-765fa791d7c4</a></p>
<hr>
<h2 id="production-environments">Production environments</h2>
<p>Production bundles are different from local ones for various reason. I like to have slightly different webpack config for production, generate them locally and commit the bundle(s) and stats file to the code base. As we store our bundles in assets and django is configured to look for static files in the assets directory, we don&rsquo;t need to do anything special here. Everything should just work with your existing system of serving static content in production.</p>
<p>We can either treat the bundles as part of source code or distribution. I like to treat them as source code even though they are not because I don&rsquo;t like building bundles on production or having my production systems depend on dev dependencies. By treating them as source code, I build them locally before preparing a new release, sync them to my static file server, commit the new stats file to source and push out the new release to the production servers. As soon as they workers on production restart, they automatically refer to the new bundles. That said, you are completely free to handle them the opposite way. You can tell git to ignore the generated bundles and stats file so they are not pushed to production and then run webpack on production just before running collectstatic. You&rsquo;ll need all your npm dependencies on production as well obviously.</p>
<p><strong>Important</strong>: Make sure production config doesn&rsquo;t use react-hot-loader or webpack-dev-server. Also make sure you use something like Uglify to compress your code and strip off any code only meant to be used in development.
<strong>Note</strong>: You should add our local webpack stats file and local bundles to .gitignore as they serve no purpose outside your local environment.
<strong>Note</strong>: I like to store all common configuration between local, staging and production in a &ldquo;base&rdquo; config file and import this file from final configs.</p>
<p><code>webpack.base.config.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;path&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">webpack</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">BundleTracker</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;webpack-bundle-tracker&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">context</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">__dirname</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">entry</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./assets/js/index&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">output</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;./assets/bundles/&#39;</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;[name]-[hash].js&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>  ], <span style="color:#75715e">// add all common plugins here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">module</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">loaders</span><span style="color:#f92672">:</span> [] <span style="color:#75715e">// add all common loaders here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resolve</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">modulesDirectories</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;node_modules&#39;</span>, <span style="color:#e6db74">&#39;bower_components&#39;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">extensions</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;.js&#39;</span>, <span style="color:#e6db74">&#39;.jsx&#39;</span>]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><br/>
`webpack.local.config.js`
```javascript
var path = require("path")
var webpack = require('webpack')
var BundleTracker = require('webpack-bundle-tracker')
<p>var config = require(&rsquo;./webpack.base.config.js')</p>
<p>// Use webpack dev server
config.entry = [
&lsquo;webpack-dev-server/client?http://localhost:3000&rsquo;,
&lsquo;webpack/hot/only-dev-server&rsquo;,
&lsquo;./assets/js/index&rsquo;
]</p>
<p>// override django&rsquo;s STATIC_URL for webpack bundles
config.output.publicPath = &lsquo;http://localhost:3000/assets/bundles/&rsquo;</p>
<p>// Add HotModuleReplacementPlugin and BundleTracker plugins
config.plugins = config.plugins.concat([
new webpack.HotModuleReplacementPlugin(),
new webpack.NoErrorsPlugin(),
new BundleTracker({filename: &lsquo;./webpack-stats.json&rsquo;}),
])</p>
<p>// Add a loader for JSX files with react-hot enabled
config.module.loaders.push(
{ test: /.jsx?$/, exclude: /node_modules/, loaders: [&lsquo;react-hot&rsquo;, &lsquo;babel&rsquo;] }
)</p>
<p>module.exports = config</p>
<pre tabindex="0"><code>

&lt;br/&gt;
`webpack.prod.config.js`
```javascript
var webpack = require(&#39;webpack&#39;)
var BundleTracker = require(&#39;webpack-bundle-tracker&#39;)

var config = require(&#39;./webpack.base.config.js&#39;)

config.output.path = require(&#39;path&#39;).resolve(&#39;./assets/dist&#39;)

config.plugins = config.plugins.concat([
  new BundleTracker({filename: &#39;./webpack-stats-prod.json&#39;}),

  // removes a lot of debugging code in React
  new webpack.DefinePlugin({
    &#39;process.env&#39;: {
      &#39;NODE_ENV&#39;: JSON.stringify(&#39;production&#39;)
  }}),

  // keeps hashes consistent between compilations
  new webpack.optimize.OccurenceOrderPlugin(),

  // minifies your code
  new webpack.optimize.UglifyJsPlugin({
    compressor: {
      warnings: false
    }
  })
])

// Add a loader for JSX files
config.module.loaders.push(
  { test: /\.jsx?$/, exclude: /node_modules/, loader: &#39;babel&#39; }
)

module.exports = config
</code></pre><br>
`settings.py`
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> DEBUG:
</span></span><span style="display:flex;"><span>    WEBPACK_LOADER[<span style="color:#e6db74">&#39;DEFAULT&#39;</span>]<span style="color:#f92672">.</span>update({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;BUNDLE_DIR_NAME&#39;</span>: <span style="color:#e6db74">&#39;dist/&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;STATS_FILE&#39;</span>: os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(BASE_DIR, <span style="color:#e6db74">&#39;webpack-stats-prod.json&#39;</span>
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><p>Generate production bundles by invoking webpack one time with production config</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node_modules/.bin/webpack --config webpack.prod.config.js
</span></span></code></pre></div><p>This will create production bundles in <code>./assets/dist/</code> and the stats file at <code>./webpack-stats-prod.json</code>.</p>
<p><code>collectstatic</code> will automatically pick up the newly created bundles.</p>
<h2 id="tip">Tip</h2>
<p>Typing the full path of the webpack binary is hard. We can create aliases for the above commands in our package.json to fix this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;scripts&#39;</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;build&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;webpack --config webpack.config.js --progress --colors&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;build-production&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;webpack --config webpack.prod.config.js --progress --colors&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;watch&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;node server.js&#39;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  ...
</span></span></code></pre></div><p>Now we can run <code>npm run build</code>, <code>npm run build-production</code> or <code>npm run watch</code>. There is no need to specify the full path of the webpack binary as NPM knows where to find it.</p>

        </div>

        
        <footer class="article-footer">
            <ul class="article-tag-list">
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://owais.lone.pw//tags/react">React
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://owais.lone.pw//tags/django">Django
                    </a>
                </li>
                
                <li class="article-tag-list-item">
                    <a class="article-tag-list-link" href="https://owais.lone.pw//tags/webpack">Webpack
                    </a>
                </li>
                
            </ul>
        </footer>
        
    </div>
    <nav id="article-nav">
</nav>

</article>



<h3>See Also</h3>
<ul>
	
	<li><a href="/blog/modern-frontends-with-django/">Let&#39;s modernize the way we handle frontend code with Django</a></li>
	
</ul>


        
    </section>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2022 Owais Lone&nbsp;
            Powered by <a href="https://gohugo.io" target="_blank">Hugo</a>. Theme based on <a href="https://github.com/owais/hugo-theme-minos">Minos</a>
        </div>
    </div>
    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css" integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
</footer>

</div>
</body>
</html>
